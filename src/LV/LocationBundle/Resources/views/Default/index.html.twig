{% extends 'template.html.twig' %}
{% block stylesheets %}
<style type="text/css">
    @media (max-width: 600px){
      #title{
        margin-bottom: 20px;
      }
      #button{
        height: 35px;
      }
    }
  </style>
{% endblock %}
{% block body %}

            <!-- ============================================================== -->
            <!-- Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <div class="page-breadcrumb">
                <div class="row">
                    <div class="col-12 d-flex no-block align-items-center">
                        <h3 class="page-title">Accueil</h3>
                        <div class="ml-auto text-right">
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"></li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ============================================================== -->
            <!-- End Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- Container fluid  -->
            <!-- ============================================================== -->
            <div class="container-fluid">
                <!-- ============================================================== -->
                <!-- Start Page Content -->
                <!-- ============================================================== -->
                <div class="row">
                    <!-- Column -->
                    <div class="col-md-6 col-lg-3">
                        <a href="{{path('csr_index')}}">
                        <div class="card card-hover">
                            <div class="box bg-cyan text-center" style="height: 100px;">
                                
                                <h1 class="font-light text-white"><i class="mdi mdi-table-edit"></i></h1>
                                <h6 class="text-white">{{contrats}} contrat(s) au {{ "now"| date('m/Y')}}</h6>
                            </div>
                        </div>
                        </a>
                    </div>
                    <!-- Column -->
                    <div class="col-md-6 col-lg-3">
                        <a href="{{path('voiture_index')}}">
                        <div class="card card-hover">
                            <div class="box bg-success text-center" style="height: 100px;">
                                <h1 class="font-light text-white"><i class="mdi mdi-car"></i></h1>
                                <h6 class="text-white">{{voituresl}} voiture(s) pour location</h6>
                            </div>
                        </div>
                        </a>
                    </div>
                    <!-- Column -->
                    <div class="col-md-6 col-lg-3">
                        <a href="{{path('client_index')}}">
                        <div class="card card-hover">
                            <div class="box bg-warning text-center" style="height: 100px;">
                                <h1 class="font-light text-white"><i class="mdi mdi-account-multiple"></i></h1>
                                <h6 class="text-white">{{clients}} client(s)</h6>
                            </div>
                        </div>
                        </a>
                    </div>
                    <!-- Column -->
                    {% if is_granted('ROLE_ADMIN') %}
                        <div class="col-md-6 col-lg-3">
                            <a href="{{path('recette_mois')}}">
                            <div class="card card-hover">
                                <div class="box bg-danger text-center" style="height: 100px;">
                                    <h1 class="font-light text-white"><i class="mdi mdi-chart-line"></i></h1>
                                    <h6 class="text-white">Recettes du {{ "now"| date('m/Y')}}: {{mp|number_format(3, '.', ',')}} TND</h6>
                                </div>
                            </div>
                            </a>
                        </div>
                    {% endif %}
                    
                    <div class="col-md-6 col-lg-3">
                        <a href="{{path('reservation_index')}}">
                        <div class="card card-hover">
                            <div class="box bg-info text-center" style="height: 100px;">
                                <h1 class="font-light text-white"><i class="mdi mdi-book-open-page-variant"></i></h1>
                                <h6 class="text-white">Réservations</h6>
                            </div>
                        </div>
                        </a>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <a href="{{path('depenses_index')}}">
                        <div class="card card-hover">
                            <div class="box bg-secondary text-center" style="height: 100px;">
                                <h1 class="font-light text-white"><i class="mdi mdi-cash-multiple"></i></h1>
                                <h6 class="text-white">Dépenses</h6>
                            </div>
                        </div>
                        </a>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <a href="{{path('rapport', {'id': 0})}}">
                        <div class="card card-hover">
                            <div class="box bg-dark text-center" style="height: 100px;">
                                <h1 class="font-light text-white"><i class="mdi mdi-folder"></i></h1>
                                <h6 class="text-white">Rapport mensuel du {{"now"|date('m/Y')}}</h6>
                            </div>
                        </div>
                        </a>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <a href="{{path('chart')}}">
                        <div class="card card-hover">
                            <div class="box bg-primary text-center" style="height: 100px;">
                                <h1 class="font-light text-white"><i class="mdi mdi-chart-bar"></i></h1>
                                <h6 class="text-white">Statistiques du {{"now"|date('Y')}}</h6>
                            </div>
                        </div>
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                         <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">Contrats en cours</h4>
                                 <div class="m-t-20 table-responsive">
                                  <table width="100%" class="table table-striped table-bordered">
                                        <thead>
                                            <tr>
                                            <th style="display: none;">Id</th>
                                            <th>Numéro contrat</th>
                                            <th>Client</th>
                                            <th>Téléphone du client</th>
                                            <th>Voiture</th>
                                            <th>Date d'arrivée</th>
                                            <th>Actions</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          {% for contrat in contratsEncours %}
                                          <tr>
                                            <td style="display: none;">{{ contrat.id}}</td>
                                            <td>{{ contrat.numContrat }}</td>
                                            <td>{{ contrat.conducteur1.nom }} {{ contrat.conducteur1.prenom }}</td>
                                            <td>{{ contrat.conducteur1.telephone }} </td>
                                            <td>{{ contrat.refVoiture.matricule }} {{ contrat.refVoiture.marque }}
                                            {{ contrat.refVoiture.modele }}</td>
                                            <td>{% if contrat.dateFin %}{{ contrat.dateFin|date('d/m/Y H:i') }}{% endif %}</td>
                                            <td class="text-center" style='white-space: nowrap'>
                                            <a href="{{ path('csr_edit', { 'id': contrat.id }) }}" class="btn btn-warning"><span class="fas fa-edit" aria-hidden="true"></span></a>
                                            </td>
                                          </tr>
                                          {% endfor %}
                                        </tbody>
                                    </table>
                                 </div>
                            </div>
                        </div>
                         <!-- Card -->
                          <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">Voitures disponibles aujourd'hui</h4>
                                 <div class="m-t-20 table-responsive">
                                  <table width="100%" class="table table-striped table-bordered">
                                        <thead>
                                            <tr>
                                            <th style="display: none;">Id</th>
                                            <th>Photo</th>
                                            <th>Voiture</th>
                                            <th>Actions</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          {% set newArray = [] %}
                                          {% for disponibilite3 in disponibilites3 %}
                                          {% if disponibilite3.etat == 'Location' or disponibilite3.etat == '' %}
                                          {% if disponibilite3.matricule not in newArray %}
                                          {% set newArray = newArray|merge([disponibilite3.matricule]) %}
                                          <tr>
                                            <td style="display: none;">{{ disponibilite3.id}}</td>
                                            <td style="padding:0 !important;" width="88px">
                                                {% if disponibilite3.photo != null %}
                                                <img src="{{asset('uploads/images/')}}{{ disponibilite3.photo }}" width="88px" height="73">
                                                {% else %}
                                                <img src="{{asset('assets/images/Pas-dimage-disponible.jpg')}}" width="88px" height="73">
                                                {% endif%}
                                            </td>
                                            <td>{{ disponibilite3.matricule }} {{ disponibilite3.marque }}
                                            {{ disponibilite3.modele }}</td>
                                            <td class="text-center" style='white-space: nowrap'>
                                            <a href="{{ path('reservation_new1', { 'time1': time1, 'time2': time2 , 'result' : duree ,'voiture': disponibilite3.matricule }) }}" role="button" class="btn btn-info btn-md" style="width: 120px;">Réserver</a>
                                            <a href="{{ path('csr_new1', { 'time1': time1, 'time2': time2 , 'result' : duree ,'voiture': disponibilite3.matricule }) }}" role="button" class="btn btn-primary btn-md" style="width: 120px;">Ajouter contrat</a>
                                            </td>
                                          </tr>
                                          {% endif %}
                                          {% endif %}
                                          {% endfor %}
                                        </tbody>
                                    </table>
                                 </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">Vidanges</h4>
                                 <div class="m-t-20 table-responsive">
                                  <table width="100%" class="table table-striped table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Voiture</th>
                                                <th>Date de la dernière vidange</th>
                                                <th>Numéro (km)</th>
                                                <th>Numéro de la prochaine vidange (km)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                          {% for vidange in voituresWithLastVidange %}
                                            <tr>
                                                <td>{{ vidange.voiture.matricule }} {{ vidange.voiture.marque }}
                                                    {{ vidange.voiture.modele }}</td>
                                                <td>
                                                    {{ vidange.last_vidange is defined and vidange.last_vidange is not null 
                                                        ? vidange.last_vidange.dateVidange|date('d/m/Y') 
                                                        : '' 
                                                    }}
                                                </td>
                                                <td>
                                                    {{ vidange.voiture.km }}
                                                </td>
                                                <td>
                                                    {{ vidange.last_vidange is defined and vidange.last_vidange is not null 
                                                        ? vidange.last_vidange.prochVidange 
                                                        : '' 
                                                    }}
                                                </td>
                                            </tr>
                                          {% endfor %}
                                        </tbody>
                                    </table>
                                 </div>
                            </div>
                        </div>
                        
                    </div>
                    <div class="col-md-6">
                         <!-- card -->
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title m-b-0">Informations de mon agence</h4>
                                <div class="m-t-20 table-responsive">
                                     <table width="100%" class="table table-striped table-bordered">
                                        <thead>
                                            <tr>
                                            <th style="display: none;">Id</th>
                                            <th>Nom agence</th>
                                            <th>Téléphone</th>
                                            <th>Adresse</th>
                                            <th>Actions</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          {% for agence in agences %}
                                          <tr>
                                            <td style="display: none;">{{ agence.id}}</td>
                                            <td>{{ agence.nom }}</td>
                                            <td>{{ agence.tel }}</td>
                                            <td>{{ agence.adresse }}</td>
                                            <td class="text-center" style='white-space: nowrap'>
                            <a href="{{ path('agence_index') }}" class="btn btn-warning"><span class="fas fa-edit" aria-hidden="true"></span></a>
                                            </td>
                                          </tr>
                                          {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!-- card new -->
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title m-b-0">Notifications</h4>
                            </div>
                            <ul class="list-style-none">
                              {% for visite in visites %}         
                              {% set difference = date(visite.dateProchVisite).diff(date("now"|date('Y-m-d'))) %}
                              {% set leftDays = difference.days %}
                              {% if leftDays<=15 and visite.dateProchVisite|date('Y-m-d')>= "now"|date('Y-m-d') %}
                                <li class="d-flex no-block card-body">
                                    <i class="fa fa-wrench w-30px m-t-5"></i>
                                    <div>
                                        <a href="#" class="m-b-0 font-medium p-0">Viste de {{ visite.refVoiture.marque }} {{ visite.refVoiture.modele }} {{ visite.refVoiture.matricule }}</a>
                                        <span class="text-muted" style="color: red;">Il reste {{leftDays}} jour(s) pour faire la visite technique du voiture</span>
                                    </div>
                                    <div class="ml-auto">
                                        <div class="tetx-right">
                                            <h5 class="text-muted m-b-0">{{visite.dateProchVisite|date('d/m/Y')}}</h5>
                                            <span class="text-muted font-16"></span>
                                        </div>
                                    </div>
                                </li>
                                {% elseif leftDays>=15 and  leftDays<=15 and visite.dateProchVisite|date('Y-m-d')>= "now"|date('Y-m-d')%}
                                <li class="d-flex no-block card-body">
                                    <i class="fa fa-wrench w-30px m-t-5"></i>
                                    <div>
                                        <a href="#" class="m-b-0 font-medium p-0">Visite de {{ visite.refVoiture.marque }} {{ visite.refVoiture.modele }} {{ visite.refVoiture.matricule }}</a>
                                        <span class="text-muted" style="color: green;">Il reste {{leftDays}} jour(s) pour faire la visite technique du voiture</span>
                                    </div>
                                    <div class="ml-auto">
                                        <div class="tetx-right">
                                            <h5 class="text-muted m-b-0">{{visite.dateProchVisite|date('d/m/Y')}}</h5>
                                            <span class="text-muted font-16"></span>
                                        </div>
                                    </div>
                                </li>
                                {% elseif visite.dateProchVisite|date('Y-m-d') < "now"|date('Y-m-d') %}
                                {% endif %}
                                {% endfor %}

                                {#{% for assurance in assurances %}
                                {% set difference = date(assurance.dateProchAssurance).diff(date("now"|date('Y-m-d'))) %}
                                {% set leftDays = difference.days %}
                                {% if assurance.dateProchAssurance|date('Y-m-d') >= "now"|date('Y-m-d') and leftDays<=15 and leftDays>=7 %}
                                <li class="d-flex no-block card-body border-top">
                                    <i class="fa fa-ambulance w-30px m-t-5"></i>
                                    <div>
                                        <a href="#" class="m-b-0 font-medium p-0">Renouvellement assurance{{ assurance.nomAssurance }}</a>
                                        <span class="text-muted" style="color:green;">Il reste {{leftDays}} jour(s) pour renouveler l'assurance</span>
                                    </div>
                                    <div class="ml-auto">
                                        <div class="tetx-right">
                                            <h5 class="text-muted m-b-0">{{ assurance.dateProchAssurance|date('d/m/Y') }}</h5>
                                            <span class="text-muted font-16"></span>
                                        </div>
                                    </div>
                                </li>
                                {% elseif assurance.dateProchAssurance|date('Y-m-d') >= "now"|date('Y-m-d') and leftDays<=7 %}
                                <li class="d-flex no-block card-body border-top">
                                    <i class="fa fa-ambulance w-30px m-t-5"></i>
                                    <div>
                                        <a href="#" class="m-b-0 font-medium p-0">Renouvellement assurance{{ assurance.nomAssurance }}</a>
                                        <span class="text-muted" style="color:red;">Il reste {{leftDays}} jour(s) pour renouveler l'assurance</span>
                                    </div>
                                    <div class="ml-auto">
                                        <div class="tetx-right">
                                            <h5 class="text-muted m-b-0">{{ assurance.dateProchAssurance|date('d/m/Y') }}</h5>
                                            <span class="text-muted font-16"></span>
                                        </div>
                                    </div>
                                </li>
                                {% elseif assurance.dateProchAssurance|date('Y-m-d') < "now"|date('Y-m-d') %}
                                {% endif %}
                                {% endfor %}#}


                               {% for vidange in vidanges %}
                               {% set leftKms = vidange.prochVidange-vidange.refVoiture.km %}
                               {% if (vidange.prochVidange>=vidange.refVoiture.km and leftKms<=1000 and leftKms>=500 ) %}
                                <li class="d-flex no-block card-body border-top">
                                    <i class="fa fa-wrench w-30px m-t-5"></i>
                                    <div>
                                        <a href="#" class="m-b-0 font-medium p-0">Vidange {{vidange.refVoiture.marque}} {{vidange.refVoiture.modele}} {{vidange.refVoiture.matricule}}</a>
                                        <span class="text-muted" style="color:green;">Il reste {{leftKms}} km pour faire le vidange du voiture</span>
                                    </div>
                                    <div class="ml-auto">
                                        <div class="tetx-right">
                                            <h5 class="text-muted m-b-0">{{ vidange.prochVidange }} km</h5>
                                            <span class="text-muted font-16"></span>
                                        </div>
                                    </div>
                                </li>
                                {% elseif (vidange.prochVidange>=vidange.refVoiture.km and leftKms<=500) %}
                                <li class="d-flex no-block card-body border-top">
                                    <i class="fa fa-wrench w-30px m-t-5"></i>
                                    <div>
                                        <a href="#" class="m-b-0 font-medium p-0">Vidange {{vidange.refVoiture.marque}} {{vidange.refVoiture.modele}} {{vidange.refVoiture.matricule}}</a>
                                        <span class="text-muted" style="color:red;">Il reste {{leftKms}} km pour faire le vidange du voiture</span>
                                    </div>
                                    <div class="ml-auto">
                                        <div class="tetx-right">
                                            <h5 class="text-muted m-b-0">{{ vidange.prochVidange }} km</h5>
                                            <span class="text-muted font-16"></span>
                                        </div>
                                    </div>
                                </li>
                                {% elseif vidange.refVoiture.km > vidange.prochVidange %}
                                {% endif %}
                                {% endfor %}


                                {% for voitureAvecPaiementImminent in voituresAvecPaiementImminent %}
                                <li class="d-flex no-block card-body border-top">
                                    <i class="fa fa-credit-card w-30px m-t-5"></i>
                                    <div>
                                        <a href="#" class="m-b-0 font-medium p-0">
                                            Paiement leasing ({{ voitureAvecPaiementImminent.voiture.marque }} {{ voitureAvecPaiementImminent.voiture.modele }} {{ voitureAvecPaiementImminent.voiture.matricule }})
                                        </a>
                                        <span class="text-muted" style="color:red;">
                                            Il reste {{ voitureAvecPaiementImminent.jours_restants }} jour(s) pour effectuer un paiement de {{ voitureAvecPaiementImminent.montant }} DTN
                                        </span>
                                    </div>
                                    <div class="ml-auto">
                                        <div class="text-right">
                                            <h5 class="text-muted m-b-0">{{ voitureAvecPaiementImminent.echeance }}</h5>
                                            <span class="text-muted font-16"></span>
                                        </div>
                                    </div>
                                </li>

                                {% endfor %}

                                
                                {#{% for vidange in vidanges %}
                                {% set leftKms = vidange.chaine-vidange.refVoiture.km %}
                                {% if vidange.chaine>=vidange.refVoiture.km  and leftKms>=500 and leftKms<=1000 %}
                                <li class="d-flex no-block card-body border-top">
                                    <i class="fa fa-wrench w-30px m-t-5"></i>
                                    <div>
                                        <a href="#" class="m-b-0 font-medium p-0">Chaîne  {{vidange.refVoiture.marque}} {{vidange.refVoiture.modele}} {{vidange.refVoiture.matricule}}</a>
                                        <span class="text-muted" style="color: green;">Il reste {{leftKms}} kms pour changer la chaîne du voiture</span>
                                    </div>
                                    <div class="ml-auto">
                                        <div class="tetx-right">
                                            <h5 class="text-muted m-b-0">{{ vidange.chaine }} km</h5>
                                            <span class="text-muted font-16"></span>
                                        </div>
                                    </div>
                                </li>
                                {% elseif vidange.chaine>=vidange.refVoiture.km  and leftKms<=500  %}
                                <li class="d-flex no-block card-body border-top">
                                    <i class="fa fa-wrench w-30px m-t-5"></i>
                                    <div>
                                        <a href="#" class="m-b-0 font-medium p-0">Chaîne {{vidange.refVoiture.marque}} {{vidange.refVoiture.modele}} {{vidange.refVoiture.matricule}}</a>
                                        <span class="text-muted" style="color: red;">Il reste {{leftKms}} kms pour changer la chaîne du voiture</span>
                                    </div>
                                    <div class="ml-auto">
                                        <div class="tetx-right">
                                            <h5 class="text-muted m-b-0">{{ vidange.chaine }} km</h5>
                                            <span class="text-muted font-16"></span>
                                        </div>
                                    </div>
                                </li>
                                {% elseif vidange.refVoiture.km > vidange.chaine %}
                                {% endif %}
                                {% endfor %}#}

                                 {#{% for vidange in vidanges %}
                                 {% set leftKms = vidange.filtre-vidange.refVoiture.km %}
                                 {% if vidange.filtre>=vidange.refVoiture.km and leftKms<=1000 and leftKms>=500 %}
                                <li class="d-flex no-block card-body border-top">
                                    <i class="fa fa-wrench w-30px m-t-5"></i>
                                    <div>
                                        <a href="#" class="m-b-0 font-medium p-0">Filtre  {{vidange.refVoiture.marque}} {{vidange.refVoiture.modele}} {{vidange.refVoiture.matricule}}</a>
                                        <span class="text-muted" style="color: green;">Il reste {{leftKms}} km pour changer le filtre du voiture</span>
                                    </div>
                                    <div class="ml-auto">
                                        <div class="tetx-right">
                                            <h5 class="text-muted m-b-0">{{ vidange.filtre }} km</h5>
                                            <span class="text-muted font-16"></span>
                                        </div>
                                    </div>
                                </li>
                                {% elseif vidange.filtre>=vidange.refVoiture.km and leftKms<=500 %}
                                <li class="d-flex no-block card-body border-top">
                                    <i class="fa fa-wrench w-30px m-t-5"></i>
                                    <div>
                                        <a href="#" class="m-b-0 font-medium p-0">Chaîne {{vidange.refVoiture.marque}} {{vidange.refVoiture.modele}} {{vidange.refVoiture.matricule}}</a>
                                        <span class="text-muted" style="color: red;">Il reste {{leftKms}} km pour changer le filtre du voiture</span>
                                    </div>
                                    <div class="ml-auto">
                                        <div class="tetx-right">
                                            <h5 class="text-muted m-b-0">{{ vidange.filtre }} km</h5>
                                            <span class="text-muted font-16"></span>
                                        </div>
                                    </div>
                                </li>
                                {% elseif vidange.refVoiture.km > vidange.filtre %}
                                {% endif %}
                                {% endfor %}#}


                                {#{% for vidange in vidanges %}
                                {% set leftKms = vidange.bougie-vidange.refVoiture.km %}
                                {% if vidange.bougie>=vidange.refVoiture.km and leftKms>=500 and leftKms<=1000%}
                                <li class="d-flex no-block card-body border-top">
                                    <i class="fa fa-wrench w-30px m-t-5"></i>
                                    <div>
                                        <a href="#" class="m-b-0 font-medium p-0">Filtre  {{vidange.refVoiture.marque}} {{vidange.refVoiture.modele}} {{vidange.refVoiture.matricule}}</a>
                                        <span class="text-muted" style="color: green;">Il reste {{leftKms}} km pour changer les bougies du voiture</span>
                                    </div>
                                    <div class="ml-auto">
                                        <div class="tetx-right">
                                            <h5 class="text-muted m-b-0">{{ vidange.bougie }} km</h5>
                                            <span class="text-muted font-16"></span>
                                        </div>
                                    </div>
                                </li>
                                {% elseif vidange.bougie>=vidange.refVoiture.km and leftKms<=500 %}
                                <li class="d-flex no-block card-body border-top">
                                    <i class="fa fa-wrench w-30px m-t-5"></i>
                                    <div>
                                        <a href="#" class="m-b-0 font-medium p-0">Chaîne {{vidange.refVoiture.marque}} {{vidange.refVoiture.modele}} {{vidange.refVoiture.matricule}}</a>
                                        <span class="text-muted" style="color: red;">Il reste {{leftKms}} km pour changer les bougies du voiture</span>
                                    </div>
                                    <div class="ml-auto">
                                        <div class="tetx-right">
                                            <h5 class="text-muted m-b-0">{{ vidange.bougie }} km</h5>
                                            <span class="text-muted font-16"></span>
                                        </div>
                                    </div>
                                </li>
                                {% elseif vidange.refVoiture.km > vidange.bougie %}
                                {% endif %}
                                {% endfor %}#}


                            </ul>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">Visites</h4>
                                 <div class="m-t-20 table-responsive">
                                    <table width="100%" class="table table-striped table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Voiture</th>
                                                <th>Date de dernier visite</th>
                                                <th>Date de prochaine visite</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                          {% for visite in voituresWithLastVisite %}
                                            <tr>
                                                <td>{{ visite.voiture.matricule }} {{ visite.voiture.marque }}
                                                    {{ visite.voiture.modele }}</td>
                                                <td>
                                                    {{ visite.last_Visite is defined and visite.last_Visite is not null 
                                                        ? visite.last_Visite.dateVisite|date('d/m/Y') 
                                                        : '' 
                                                    }}
                                                </td>
                                                <td>
                                                    {{ visite.last_Visite is defined and visite.last_Visite is not null 
                                                        ? visite.last_Visite.dateProchVisite|date('d/m/Y') 
                                                        : '' 
                                                    }}
                                                </td>
                                            </tr>
                                          {% endfor %}
                                        </tbody>
                                    </table>
                                 </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">Réservations</h4>
                                <div class="m-t-20 table-responsive">
                                    <table width="100%" class="table table-striped table-bordered">
                                        <thead>
                                            <tr>
                                                <th>N°</th>
                                                <th>Date de début</th>
                                                <th>Date de fin</th>
                                                <th>Voiture</th>
                                                <th>Client</th>
                                                <th>Téléphone</th>
                                                <th>Avance</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for reservation in reservations %}
                                                <tr>
                                                    <td>{{ reservation.numReservation }}</td>
                                                    <td>{{ reservation.dateDebut ? reservation.dateDebut|date('d/m/Y') : '-' }}</td>
                                                    <td>{{ reservation.dateFin ? reservation.dateFin|date('d/m/Y') : '-' }}</td>
                                                    <td>{{ reservation.voiture }}</td>
                                                    <td>{{ reservation.client }}</td>
                                                    <td>{{ reservation.telephone }}</td>
                                                    <td>{{ reservation.paiment }} TND</td>
                                                </tr>
                                            {% else %}
                                                <tr>
                                                    <td colspan="7" class="text-center">Aucune réservation trouvée.</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <!-- ============================================================== -->
                <!-- End PAge Content -->
                <!-- ============================================================== -->
                <!-- ============================================================== -->
                <!-- Right sidebar -->
                <!-- ============================================================== -->
                <!-- .right-sidebar -->
                <!-- ============================================================== -->
                <!-- End Right sidebar -->
                <!-- ============================================================== -->
            </div>
            <!-- ============================================================== -->
            <!-- End Container fluid  -->
            <!-- ============================================================== -->
{% endblock%}


