{% extends 'base.html.twig' %}
{% block menu %}
<div class="subnavbar">
  <div class="subnavbar-inner">
    <div class="container">
      <ul class="mainnav">
        <li><a href="{{path('accueil')}}"><i class="icon-dashboard"></i><span>Tableau de Bord</span> </a> </li>
        <li><a href="{{path('voiture_index')}}"><i class="fa fa-automobile"></i><span>Vehicule</span> </a> </li>
        <li><a href="{{path('client_index')}}"><i class="shortcut-icon icon-user"></i><span>Client</span> </a></li>
        <li><a href="{{path('reservation_index')}}"><i class="shortcut-icon icon-save"></i><span>Reservation</span> </a> </li>
        <li class="active"><a href="{{path('csr_index')}}"><i class="shortcut-icon icon-edit"></i><span>Contrat</span> </a> </li>
        <li><a href="{{path('paiement_index')}}"><i class="shortcut-icon icon-random"></i><span>Paiement</span> </a> </li>
        <li><a href="{{path('facture_index')}}"><i class="shortcut-icon icon-list-alt"></i><span>Facture</span> </a> </li>
      </ul>
    </div>
  </div>
</div>
{% endblock %}
{% block body %}
<div class="main">
  <div class="main-inner">
    <div class="container">

<div class="row">
  <div class="span5">
    <section class="content-header"><center>
      <a href="{{path('contrat_index')}}"><ol class="breadcrumb">
        <li><h3>Contrat avec Réservation</h3></li>
      </ol></a></center>
    </section>
  </div>
  <div class="span6">
    <section class="content-header active"><center><a href="{{path('csr_index')}}">
      <ol class="breadcrumb center">
        <li><h1>Liste de Contrat</h1></li>
      </ol></a></center>
    </section>
  </div>
</div>
      <div class="row">
        <div class="span12">
  <div class="content-wrapper">
    <section class="content-header">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ path('accueil') }}"><i class="fa fa-dashboard"></i> Tableau de Bord</a></li>
        <li  class="breadcrumb-item active">/ Contrat</li>
      </ol>
    </section>

    <!-- Main content -->
     <section class="content" style="padding-left:25px;padding-right:25px;">
      <div class="row">
        <div class="col-md-12">
              <!-- TABLE: LATEST ORDERS -->
              <div class="box box-info">
                <div class="box-header with-border">
                  <h1><center> Liste de Contrat </center> </h1>
                </div> <br><br>
<div class="row">
<div class="span12"> 
      <div align="right" class="form-group">
          <div class="input-group">
            <a href="{{ path('disponibilite_search') }}" class="btn btn-primary btn-lg"> Ajouter un Contrat</a>
          </div>
      </div>
</div>
  <div class="span3">
    numContrat :   <br> <input type="text" id="numcontrat" onkeyup="numcontrat()" placeholder="Numero de Contrat..">
  </div>
  <div class="span3">
    Date Debut :    <br><input type="text" id="dd" onkeyup="dd()" placeholder="Date de debut..">
  </div>
  <div class="span3">
    Date Fin :   <br> <input type="text" id="df" onkeyup="df()" placeholder="Date de fin..">
  </div>
  <div class="span2">
    Search All : <br><input type="text" id="myInput" onkeyup="myFunction()" placeholder="Recherche dans la table.." title="Type in a name">

</div> <br><br>
              </div>
                <div class="row">
                <div class="box-body">
                  <div class="table-responsive">
                    <table id="example" class="display table table-striped"  style="background-color:#f1f1f1;padding-top:25px;padding-bottom:25px;padding-left:25px;padding-right:25px; border:1px;border-style: solid;border-color: #B8B8B8;">
        <thead>
            <tr>
                <th>Numéro contrat</th>
                <th>Premier conducteur</th>
                <th>Matricule</th>
                <th>Date contrat</th>
                <th>Date début</th>
                <th>Date fin</th>
                <th>Km départ</th>
                <th>Niveau carburant</th>
                <th>Tarif</th>
                <th>Recette</th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody id="myTable">
        {% for result in results %}
            <tr>
                <td>{{ result.numContrat }}</td>
                <td>{{ result.conducteur1.nom }} {{ result.conducteur1.prenom }}</td>
                <td>{% if result in contrats%}{{ result.refReservation.refVoiture.matricule }}{% else %}{{ result.refVoiture.matricule }}{% endif %}</td>
                <td>{% if result.dateContrat %}{{ result.dateContrat|date('d/m/Y') }}{% endif %}</td>
                <td>{% if result in contrats%}{% if result.refReservation.dateDebut %}{{ result.refReservation.dateDebut|date('d/m/Y') }}{% endif %}{% else %}{% if result.dateDebut %}{{ result.dateDebut|date('d/m/Y') }}{% endif %}{% endif %}</td>
                <td>{% if result in contrats%}{% if result.refReservation.dateFin %}{{ result.refReservation.dateFin|date('d/m/Y') }}{% endif %}{% else %}{% if result.dateFin %}{{ result.dateFin|date('d/m/Y') }}{% endif %}{% endif %}</td>
                <td>{{ result.kmDepart }}</td>
                <td>{{ result.niveauCarburant }}</td>
                <td>{{ result.tarif }}</td>
                <td>{{ result.recette }}</td>
                {% if (result in cSRs) %}
                       {% for paiement in paiements if (paiement.montantPaye != 0 and paiement.refCsr.id is defined and paiement.refCsr.id == result.id)  %}
                        {% if (paiement.montantRestant == 0) %}
                        <td>
                            <h4 class="text-center"><input type="button" class="btn btn-default btn-sm" value="Modifier" readonly></h4>
                        </td>
                        <td>
                            <h4 class="text-center"><input type="button" class="btn btn-default btn-sm" value="Payée" readonly></h4>
                        </td>                        
                        <td>
                            <h4 class="text-center"><a href="{{ path('facture_new2', { 'id': result.id }) }}" role="button" class="btn btn-info btn-sm">Facture</a></h4>
                        </td>
						<td></td>
                        {% else %}  
                        <td>
                            <h4 class="text-center"><input type="button" class="btn btn-default btn-sm" value="Modifier" readonly></h4>
                        </td>
                        <td>
                            <h4 class="text-center"><a href="{{ path('paiement_edit2', { 'id': result.id }) }}" role="button" class="btn btn-warning btn-sm">en cours</a></h4>
                        </td>
                        <td>
                            <h4 class="text-center"><input type="button" class="btn btn-default btn-sm" value="Facture" readonly></h4>
					    </td>
						<td></td>
                        {% endif %}
                        {% else %} 
                        <td>
                            <h4 class="text-center"><a href="{{ path('csr_edit', { 'id': result.id }) }}" role="button" class="btn btn-success btn-sm">Modifier</a></h4>
                        </td>
                        <td>
                            <h4 class="text-center"><a href="{{ path('paiement_new2', { 'id': result.id }) }}" role="button" class="btn btn-danger btn-sm">Paiement</a></h4>
                        </td>
                        <td>
                            <h4 class="text-center"><input type="button" class="btn btn-default btn-sm" value="Facture" readonly></h4>
                        </td>
                        <td>
                            <h4 class="text-center"><a href="{{ path('csr_show', { 'id': result.id }) }}" role="button" class="btn btn-danger btn-sm">Supprimer</a></h4>
                           
                        </td>
                        {% endfor %}
                     {% else %}
                        {% for paiement in paiements if ((paiement.montantPaye != 0) and (paiement.refContrat.id is defined and paiement.refContrat.id == result.id))  %}
                        {% if (paiement.montantRestant ==0) %}
                        <td>
                            <h4 class="text-center"><input type="button" class="btn btn-default btn-sm" value="Modifier" readonly></h4>
                        </td>
                        <td>
                            <h4 class="text-center"><input type="button" class="btn btn-default btn-sm" value="Payée" readonly></h4>
                        </td>                        
                        <td>
                            <h4 class="text-center"><a href="{{ path('facture_new1', { 'id': result.id }) }}" role="button" class="btn btn-info btn-sm">Facture</a></h4>
                        </td>
						<td></td>
                        {% else %}  
                        <td>
                            <h4 class="text-center"><input type="button" class="btn btn-default btn-sm" value="Modifier" readonly></h4>
                        </td>
                        <td>
                            <h4 class="text-center"><a href="{{ path('paiement_edit1', { 'id': result.id }) }}" role="button" class="btn btn-warning btn-sm">en cours</a></h4>
                        </td>
                        <td>
                            <h4 class="text-center"><input type="button" class="btn btn-default btn-sm" value="Facture" readonly></h4>
                        </td>
						<td></td>
                        {% endif %}
                        {% else %} 
                        <td>
                            <h4 class="text-center"><a href="{{ path('contrat_edit', { 'id': result.id }) }}" role="button" class="btn btn-success btn-sm">Modifier</a></h4>
                        </td>
                        <td>
                            <h4 class="text-center"><a href="{{ path('paiement_new', { 'id': result.id }) }}" role="button" class="btn btn-danger btn-sm">Paiement</a></h4>
                        </td>
                        <td>
                            <h4 class="text-center"><input type="button" class="btn btn-default btn-sm" value="Facture" readonly></h4>
                        </td><td>
						<h4 class="text-center"><a href="{{ path('contrat_show', { 'id': result.id }) }}" role="button" class="btn btn-danger btn-sm">Supprimer</a></h4>
                            </td>
                        {% endfor %} 
                        {% endif %}
                        <td>
                          {% if result in cSRs %}
                           {% for retour in retours if (retour.refCsr.id is defined and retour.refCsr.id == result.id) %}  
                               <button class="btn btn-default" readonly>Retournée</button>
                           {% else %} 
                               <h4 class="text-center"><a href="{{ path('retour_new2', { 'id': result.id }) }}" role="button" class="btn btn-success">Retour</a></h4>
                           {% endfor %}
                           {% else %}
                           {% for retour in retours if ((retour.refContrat.id is defined) and (retour.refContrat.id == result.id )) %}  
                               <button class="btn btn-default" readonly>Retournée</button>
                           {% else %} 
                               <h4 class="text-center"><a href="{{ path('retour_new1', { 'id': result.id }) }}" role="button" class="btn btn-success">Retour</a></h4>
                           {% endfor %}
                           {% endif %}
                        </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
                  </div>
                </div>
                </div>
      </div>

    </div>
  </section>
</div>

</div>
</div>
</div>
</div>
</div><!--
 </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>-->
{% endblock %}
{% block javascripts %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script>
$(document).ready(function(){
    $('#example').DataTable( {
        "pagingType": "full_numbers"
    } );
  $("#myInput").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#myTable tr").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    });
  });
});

function dd() {
  var input, filter, table, tr, td, i;
  input = document.getElementById("dd");
  filter = input.value.toUpperCase();
  table = document.getElementById("example");
  tr = table.getElementsByTagName("tr");
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[3];
    if (td) {
      if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }       
  }
}

function df() {
  var input, filter, table, tr, td, i;
  input = document.getElementById("df");
  filter = input.value.toUpperCase();
  table = document.getElementById("example");
  tr = table.getElementsByTagName("tr");
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[4];
    if (td) {
      if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }       
  }
}

function numcontrat() {
  var input, filter, table, tr, td, i;
  input = document.getElementById("numcontrat");
  filter = input.value.toUpperCase();
  table = document.getElementById("example");
  tr = table.getElementsByTagName("tr");
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[0];
    if (td) {
      if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }       
  }
}
/*
$(document).ready(function() {
  //  $('#example').DataTable();
  
    $('#example').DataTable( {
        "pagingType": "full_numbers"
    } );
	/* $('#example').DataTable( {
        initComplete: function () {
            this.api().columns().every( function () {
                var column = this;
                var select = $('<select><option value=""></option></select>')
                    .appendTo( $(column.footer()).empty() )
                    .on( 'change', function () {
                        var val = $.fn.dataTable.util.escapeRegex(
                            $(this).val()
                        );
 
                        column
                            .search( val ? '^'+val+'$' : '', true, false )
                            .draw();
                    } );
 
                column.data().unique().sort().each( function ( d, j ) {
                    select.append( '<option value="'+d+'">'+d+'</option>' )
                } );
            } );
        }
    } );
} );*/

</script>
{% endblock %}
