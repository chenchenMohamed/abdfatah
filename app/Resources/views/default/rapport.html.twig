{% extends 'template.html.twig' %}
{% block stylesheets %}
<style type="text/css">
    @media (max-width: 600px){
      #title{
        margin-bottom: 20px;
      }
      #button{
        height: 35px;
      }
    }
  </style>
{% endblock %}
{% block body %}
<!-- ============================================================== -->
            <!-- Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <div class="page-breadcrumb">
                <div class="row">
                    <div class="col-12 d-flex no-block align-items-center">
                        {#<h4 class="page-title">Liste des voitures pour location</h4>#}
                        <div class="ml-auto text-right col-12">
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="{{path('accueil')}}">Accueil</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Rapport mensuel</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ============================================================== -->
            <!-- End Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- Container fluid  -->
            <!-- ============================================================== -->
            <div class="container-fluid">
                <!-- ============================================================== -->
                <!-- Start Page Content -->
                <!-- ============================================================== -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <h3 class="card-title m-b-0 col-md-9 col-12" id="title">Rapport mensuel du {{rapportMonth}}/{{rapportYear}}</h3>
                                </div>
                                <br>

                                {{ form_start(form) }}
                                <div class="col-md-12 row">
                                    <div class="col-md-6 col-12">
                                        <div class="form-group" style="display: none;">
                                            {{ form_errors(form.date.day) }}
                                            {{ form_widget(form.date.day) }}
                                        </div>
                                        <div class="form-group">
                                            <label>Mois : {{ form_errors(form.date.year) }}</label>
                                            <div class="input-group">
                                                {{ form_widget(form.date.month, {'attr': {'class':'form-control','placeholder':'jj/mm/aaaa'}}) }}
                                                
                                                <div class="input-group-append">
                                                    <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="input-group">
                                            {{ form_widget(form.date.year, {'attr': {'class':'form-control','placeholder':'jj/mm/aaaa'}}) }}
                                            
                                            <div class="input-group-append">
                                                <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="col-md-2 col-6">
                                <div class="form-group">
                                  <label><span style="color:white;">Durée :</span></label>
                                  <label><span style="color:white;">Durée :</span></label>

                                  <input type="submit" value="Chercher" class="btn btn-success" style="height: 37px;">
                                  
                                </div>
                                <div class="form-group">
                                  
                                  

                                  <a href="{{ path('print2', {'rapportMonth': rapportMonth, 'rapportYear': rapportYear, 'montantEncaisse': montantEncaisse, 'montantAEncaisse': montantAEncaisse , 'credit': credit, 'frais': frais, 'nbreVoitures': nbreVoitures}) }}" role="button" class="btn btn-primary" target="blank">Imprimer</a>
                                </div>
                               </div>

                               <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Matricule {{ form_errors(form.voiture) }}</label>             
                                            {{ form_widget(form.voiture, {'attr': {'class':'select2 form-control custom-select','style':'width: 100%; height:36px;', 'onchange': 'javascript:handleSelect(this)'}}) }}
                                           
                                        </div>
                                    </div>
                                    
                                {{ form_end(form) }}
                                <br>

                                </div>
                                <div class=" col-12 row">
                                <div class="col-md-4 col-12">
                                    <div class="form-group">
                                        <label><h4>Recettes du mois</h4></label>
                                        <input type="text" value="{{montantEncaisse|number_format(3, '.', ',')}} DT" style="font-size:20px;" id="recette" disabled>
                                    </div>
                                </div>
                                <div class="col-md-4 col-12">
                                    <div class="form-group">
                                    <label><h4>Montant à encaisser</h4></label>
                                        <input type="text" value="{{montantAEncaisse|number_format(3, '.', ',')}} DT" style="font-size:20px;" disabled>
                                    </div>
                                </div>
                                <div class="col-md-4 col-12">
                                    <div class="form-group">
                                    <label><h4>Crédit du mois</h4></label>
                                        <input type="text" value="{{credit|number_format(3, '.', ',')}} DT" style="font-size:20px;" id="credit" disabled>
                                    </div>
                                </div>
                                
                                </div>
                                <div class=" col-12 row">
                                <div class="col-md-4 col-12">
                                    <div class="form-group">
                                        <label><h4>Montant Leasing</h4></label>
                                        <input type="text" value="{{montantAEncaisse|number_format(3, '.', ',')}} DT" style="font-size:20px;" id="leasing" disabled>
                                    </div>
                                </div>
                                <div class="col-md-4 col-12">
                                    <div class="form-group">
                                    <label><h4>Frais généraux</h4></label>
                                        <input type="text" value="{{frais|number_format(3, '.', ',')}} DT" style="font-size:20px;" id="frais" disabled>
                                    </div>
                                </div>
                                <div class="col-md-4 col-12">
                                    <div class="form-group">
                                        <label><h4>Voitures sous Leasing</h4></label>
                                        <input type="text" value="{{nbreVoitures}}" style="font-size:20px;" id="nbreVoitures" disabled>
                                    </div>
                                </div>
                                
                                </div>
                                
                                <h4>Liste de clients non réglés</h4>
                                <div class="table-responsive">
                                  <table width="100%" class="table table-striped table-bordered">
                                        <thead>
                                            <tr>
                                            <th style="display: none;">Id</th>
                                            <th>Numéro contrat</th>
                                            <th>Client</th>
                                            <th>Montant</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          {% for modele in clientNonRegle %}
                                          <tr>
                                            <td style="display: none;">{{ modele.id}}</td>
                                            <td class="numContrat">{{ modele.refCsr.numContrat}}</td>
                                            <td class="client">{{ modele.refCsr.conducteur1.nom}} {{ modele.refCsr.conducteur1.prenom}}</td>
                                            <td class="montant">{{ modele.montantRestant|number_format(3, '.', ',')}} DT</td>
                                          </tr>
                                          {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <div class=" col-12 row">
                                <div class="col-md-4 col-12">
                                    <div class="form-group" style="display: none;">
                                        <label><h4>Résultat du mois</h4></label>
                                        <input type="text" value="" style="font-size:20px;">
                                    </div>
                                </div>   
                                <div class="col-md-4 col-12">
                                    <div class="form-group">
                                        <label><h4>Résultat du mois</h4></label>
                                        <input type="text" value="{{(montantEncaisse-frais-montantAEncaisse)|number_format(3, '.', ',')}} DT" style="font-size:20px;" id="resultat" disabled>
                                    </div>
                                </div>
                                <div class="col-md-4 col-12">
                                    <div class="form-group" style="display: none;">
                                        <label><h4>Résultat du mois</h4></label>
                                        <input type="text" value="" style="font-size:20px;">
                                    </div>
                                </div>
                                
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ============================================================== -->
                <!-- End PAge Content -->
                <!-- ============================================================== -->
                <!-- ============================================================== -->
                <!-- Right sidebar -->
                <!-- ============================================================== -->
                <!-- .right-sidebar -->
                <!-- ============================================================== -->
                <!-- End Right sidebar -->
                <!-- ============================================================== -->
            </div>
            <!-- ============================================================== -->
            <!-- End Container fluid  -->
            <!-- ============================================================== -->
{% endblock %}

{% block javascripts %}
<script>

    
strUser=$("#form_voiture option:selected").text();
console.log(strUser)
if(strUser==""){
$('tbody tr').hide();
}
else{
  $('tbody tr').show();
  }
  if(strUser) {
        //$('tbody tr').not($('tbody tr[var="' + strUser + '"]')).hide();
        //$("#matricule").attr("value",$('#myTable tr[var="' + strUser + '"]').find("td:eq(1)").html());
        //$("#mat").attr("value",$('#myTable tr[var="' + strUser + '"]').find("td:eq(1)").html())
        $("#marque").attr("value",$('#myTable tr[var="' + strUser + '"]').find("td:eq(2)").html());
        $("#modele").attr("value",$('#myTable tr[var="' + strUser + '"]').find("td:eq(3)").html());
        $("#couleur").attr("value",$('#myTable tr[var="' + strUser + '"]').find("td:eq(4)").html());
        $("#codeRadio").attr("value",$('#myTable tr[var="' + strUser + '"]').find("td:eq(5)").html());
        $("#km").attr("value",$('#myTable tr[var="' + strUser + '"]').find("td:eq(6)").html());
        $("#fournisseur").attr("value",$('#myTable tr[var="' + strUser + '"]').find("td:eq(7)").html());
        $("#prix").attr("value",$('#myTable tr[var="' + strUser + '"]').find("td:eq(8)").html());
        $("#miseEnCirculation").attr("value",$('#myTable tr[var="' + strUser + '"]').find("td:eq(9)").html());
        $("#datePremierPay").attr("value",$('#myTable tr[var="' + strUser + '"]').find("td:eq(10)").html());
        $("#dateDernierPay").attr("value",$('#myTable tr[var="' + strUser + '"]').find("td:eq(11)").html());
        $("#autoFinancement").attr("value",$('#myTable tr[var="' + strUser + '"]').find("td:eq(12)").html());
        $("#montantTotal").attr("value",$('#myTable tr[var="' + strUser + '"]').find("td:eq(13)").html());
        $("#montantMensuel").attr("value",$('#myTable tr[var="' + strUser + '"]').find("td:eq(14)").html());
        
  };


function handleSelect(elm)
{
  if(elm.value != '' ){
window.location = "../rapport/"+elm.value;
}
else{
  window.location = "../rapport/0";
}
};
</script>
{% endblock %}
