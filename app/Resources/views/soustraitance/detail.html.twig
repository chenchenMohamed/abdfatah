{% extends 'template.html.twig' %}
{% block stylesheets %}
<style type="text/css">
    @media (max-width: 600px){
      #title{
        margin-bottom: 20px;
      }
      #button{
        height: 35px;
      }
      #details{
        width: 763px;
      }
    }
  </style>
{% endblock %}
{% block body %}
<!-- ============================================================== -->
            <!-- Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <div class="page-breadcrumb">
                <div class="row">
                    <div class="col-12 d-flex no-block align-items-center">
                        {#<h4 class="page-title">Liste des voitures pour location</h4>#}
                        <div class="ml-auto text-right col-12">
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="{{path('accueil')}}">Accueil</a></li>
                                    <li class="breadcrumb-item"><a href="{{path('soustraitance_index')}}">Liste des contrats de soustraitance</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Détails contrat</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ============================================================== -->
            <!-- End Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- Container fluid  -->
            <!-- ============================================================== -->
            <div class="container-fluid">
                <!-- ============================================================== -->
                <!-- Start Page Content -->
                <!-- ============================================================== -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h3 class="card-title m-b-0 col-md-6 col-12" id="title">Détails contrat</h3>
                                <br>
                                <div class="table-responsive">
                                  <table width="100%" class="table table-striped table-bordered">
                                        <thead>
                                            <tr>
                                              <th>Numéro contrat</th>
                                              <th>Voiture</th>
                                              {#<th>Modele</th>#}
                                              {#<th>Montant total</th>#}
                                              <th>Montant payé</th>
                                              <th>Montant restant</th>
                                              <th>Mois restants</th>
                                              <th>Date premier payement</th>
                                              <th>Date dernier payement</th>
                                              <th>Etat</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          <tr>
                                            <td>{{ soustraitance.numSoustraitance }}</td>
                                            <td>{{ soustraitance.refVoiture.matricule }}</td>
                                            {#<td>{{ soustraitance.refVoiture.modele }} {{ soustraitance.refVoiture.marque}}</td>#}
                                            {#<td>{{ soustraitance.montantTotal }}</td>#}
                                            <td>{{ soustraitance.montantPaye }}</td>
                                            <td>{{ soustraitance.montantRestant }}</td>
                                            <td>{{ soustraitance.nbrePayRestant }}</td>
                                            <td>{{ soustraitance.datePremierPay|date("d/m/Y") }}</td>
                                            <td>{{ soustraitance.dateDernierPay|date("d/m/Y") }}</td>
                                            <td>{{ soustraitance.etat }}</td>
                                          </tr>
                                        </tbody>
                                    </table>
                                    <table width="100%" class="table table-striped table-bordered" id="details">
        <thead>
            <tr>
                <th>Date</th>
                <th>Montant</th>
                <th>Etat</th>
                
            </tr>
        </thead>
        <tbody>
            {% set date1 =  soustraitance.datePremierPay %}
        {% for i in 1..dif_en_mois %}
        <tr>
            <td >{% if date1 %}{{ date1|date("d/m/Y") }}{% endif %}</td>
            <td>{{ soustraitance.montantMensuel }} TND</td>
                {% if ( dt == '' ) %}
                {% if(date1==soustraitance.datePremierPay) %}
                <td class="text-center" style='white-space: nowrap'><a href="{{ path('paiementsoustraitance_new', { 'id': soustraitance.id,'date' : date1|date('Y-m-d')}) }}"><button class="btn btn-success" >&nbsp;Paiement&nbsp;</button></a></td>
                {% else %}
                {#<td class="text-center" style='white-space: nowrap'><input type="button" class="btn btn-secondary" value="Non Payée" readonly></td>#}
                <td class="text-center" style='white-space: nowrap'><a href="{{ path('paiementsoustraitance_new', { 'id': soustraitance.id,'date' : date1|date('Y-m-d')}) }}"><button class="btn btn-success" >&nbsp;Paiement&nbsp;</button></a></td>
                {% endif %}
                 {% else %}
                
                {% for paiementSoustraitance in paiementSoustraitances  if ( date1 == paiementSoustraitance.date and paiementSoustraitance.refSoustraitance.id ==  soustraitance.id ) %}
                <td class="text-center" style='white-space: nowrap'><input type="button" class="btn btn-secondary" value="&nbsp;&nbsp;&nbsp;&nbsp;Payée &nbsp;&nbsp;&nbsp;" readonly>

                <a href="{{ path('paiementsoustraitance_annuler', { 'id': soustraitance.id,'date' : date1|date('Y-m-d')}) }}"><button class="btn btn-warning">&nbsp;&nbsp;Annuler&nbsp;&nbsp;</button></a>
                
                {#<a href="" data-placement="top" title="" data-original-title="Supprimer"  data-toggle="modal" data-target="#deleteModal{{ soustraitance.id }}"><button class="btn btn-warning">&nbsp;&nbsp;Annuler&nbsp;&nbsp;</button></a>

                <div class="modal fade none-border" id="deleteModal{{ soustraitance.id }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                          <h4 class="modal-title">Confirmation de supression</h4>
                                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                        </div>
                                        <div class="modal-body" >
                                            <p><span>Voulez-vous vraiment annuler le paiement de cette tranche ?</span></p>

                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                                            <a href="{{ path('paiementsoustraitance_annuler', { 'id': soustraitance.id,'date' : date1|date('Y-m-d')}) }}" class="btn btn-primary"  id="lien" >Confirmer</a>
                                        </div>
                                    </div>
                                </div>
                            </div>#}
                </td>
                {% else %}
                {% if ( date1 == dt|date_modify("+1 month") ) %}
                <td class="text-center" style='white-space: nowrap'><a href="{{ path('paiementsoustraitance_new', { 'id': soustraitance.id,'date' : date1|date('Y-m-d')}) }}"><button class="btn btn-success">&nbsp;Paiement&nbsp;</button></a></td>
                 {% elseif ( dt == '' ) %}
                <td class="text-center" style='white-space: nowrap'><a href="{{ path('paiementsoustraitance_new', { 'id': soustraitance.id,'date' : date1|date('Y-m-d')}) }}"><button class="btn btn-success form-control" >&nbsp;Paiement&nbsp;</button></a></td>
                 {% else %}
                <td class="text-center" style='white-space: nowrap'><a href="{{ path('paiementsoustraitance_new', { 'id': soustraitance.id,'date' : date1|date('Y-m-d')}) }}"><button class="btn btn-success">&nbsp;Paiement&nbsp;</button></a></td>
                {% endif %}
                {% endfor %}
                {% endif %}
            {% set date1 = date1|date_modify("+1 month") %}
        </tr>
             {% endfor %}
           
            
        </tbody>
    </table>
                                </div>
                            </div>
                            <div class="border-top" >
                                    <div class="card-body" style="float: right;" >
                                        <div class="btn-group">
                                        <a href="{{ path('soustraitance_index') }}" class="btn btn-secondary"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Retour&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
                                        </div>
                                    </div>
                              </div>
                        </div>
                    </div>
                </div>
                <!-- ============================================================== -->
                <!-- End PAge Content -->
                <!-- ============================================================== -->
                <!-- ============================================================== -->
                <!-- Right sidebar -->
                <!-- ============================================================== -->
                <!-- .right-sidebar -->
                <!-- ============================================================== -->
                <!-- End Right sidebar -->
                <!-- ============================================================== -->
            </div>
            <!-- ============================================================== -->
            <!-- End Container fluid  -->
            <!-- ============================================================== -->
{% endblock %}





